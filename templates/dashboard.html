<! OCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

  <html>

  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/altme_style.css">
    <link rel="icon" type="image/png" href="/static/img/icon.png" sizes="16x16">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/dist/vanilla-notify.css" />

    <script src="/static/dist/vanilla-notify.js"></script>
  </head>

  <body>


    <nav id="navBar" class="js-nav nav-02  nav-02--sticky  nav-02--sticky--white  ">
      <div class="nav-02__box">
        <div class="nav-02__logo"><a class="nav-02__link" href="https://altme.io/" target="_self">
            <img loading="lazy" class="nav-02__logo_img"
              src="/static/img/altme-decentralized-identity-wallet-did-logo.webp" height="70" alt="Logo" />
          </a></div>

        <div class="nav-02__list_wrapper  ">
          <div class="nav-02__list nav-02__list--desktop">
            <div class="nav-02__item" id="faqNav">
              <a class="button   button--black-outline  button--empty " href="https://altme.io/" target="_self">
                <p class="linkP">Back to home</p>
              </a>
            </div>
            <div class="nav-02__item">

              <a data-stripe-product-id="" data-stripe-mode="payment" data-successful-payment-url=""
                data-cancel-payment-url="" class="button button--accent-bg "
                href="mailto:contact@altme.io?cc=hugo@altme.io&subject=Altme" target="_blank">
                <div class="contactSpan">
                  <p class="contactP">Contact</p>
                </div>
              </a>
            </div>
          </div>


        </div>

      </div>

    </nav>
    <div id="menuDiv" class="nav-02__list_wrapper  ">
      <div class="nav-02__list nav-02__list--desktop">
        <div class="nav-02__item">
          <a class="button   button--black-outline  button--empty " href="https://altme.io/" target="_self">
            <p class="linkP"> Back to home
            </p>
          </a>
        </div>
        <div class="nav-02__item">

          <a data-stripe-product-id="" data-stripe-mode="payment" data-successful-payment-url=""
            data-cancel-payment-url="" class="button button--accent-bg "
            href="mailto:contact@altme.io?cc=hugo@altme.io&subject=Altme" target="_blank">
            <div class="contactSpan">
              <p class="contactP">Contact</p>
            </div>
          </a>
        </div>
      </div>


    </div>
    <div id="navBarMobile" class="js-nav nav-02  nav-02--sticky  nav-02--sticky--white  ">
      <div class="nav-02__box">
        <div class="nav-02__logo">
          <a class="nav-02__link" href="https://altme.io/" target="_self">
            <img loading="lazy" class="nav-02__logo_img"
              src="https://unicorn-cdn.b-cdn.net/653ef4c9-deb9-41af-9fa0-dc973cdd8134/altme-identity-wallet---blockchain---web3---self-sovereign-identity---decentralized-identity---ebsi---ssi---did---digital-identity---logo.png"
              height="70" alt="Logo" />
          </a>
        </div>


      </div>
      <button id="buttonMenu">
        <div id="buttonMenuLogo">
          <img id="imageButtonMenu" class="imgButtonMenuInactive" src="/static/img/div.png">
        </div>
      </button>

    </div>
    <div id="mainBox">
      <div id="dashboard">
        <div id="line1Dashboard">
          <p id="dashboardTitle">{{organisation}} Dashboard</p>
          <button class="buttonAltmeInversed" onclick="logout()">Logout</button>
        </div>
        <div id="line2Dashboard">
          <p class="title">Change wallet customization</p>
          <div id="line2DashboardDiv">
            <a class="buttonAltme" id="modifyConfiguration" href="/setup">START TO CUSTOMIZE YOUR WALLET</a>
            <button class="buttonAltmeInversed" onclick="alertUsers()">ALERT USERS OF A NEW CONFIGURATION BY
              EMAIL</button>
          </div>
          <!--<div id="line2DashboardDiv">

            <input type="text" id="message" placeholder="Message to send by chat..">
            <button class="buttonAltme" onclick="sendInfo()">SEND MESSAGES TO USERS BY CHAT</button>

          </div>-->

        </div>

        <div id="line3Dashboard" class="{{customer_plan}}">
          <p class="title">Add a new user</p>
          <div id="userAdder{{customer_plan}}">
            <input placeholder="First name" type="text" class="inputDashboard{{customer_plan}}" id="firstName">
            <input placeholder="Last name" type="text" class="inputDashboard{{customer_plan}}" id="lastName">
            <input placeholder="email" type="text" class="inputDashboard{{customer_plan}}" id="emailAdd">

            <button id="buttonAddUser{{customer_plan}}" class="buttonAltme" onclick="addUser()">Add user</button>
          </div>

        </div>
          <table id="tableDashboard" class="sortable">
            <tr>
              <th id="tHead0" onclick="sortTable(0)">Creation</th>

              <th id="tHead1" onclick="sortTable(1)">First name</th>
              <th id="tHead2" onclick="sortTable(2)">Last name</th>
              <th id="tHead3" onclick="sortTable(3)">Email</th>
              <th>Status</th>

              <th>Password</th>
              <!--<th></th>-->
              <th class="{{customer_plan}}"></th>


            </tr>

            {% for row in rows %}
            <tr>
              <td>{{row[4]}}</td>
              <td>{{row[1]}}</td>
              <td>{{row[2]}}</td>
              <td>{{row[0]}}</td>
              <td>
                <div>
                  <select id="newStatus{{row[0]}}" class="inputDashboard">
                    <option onclick="changeStatus('{{row[0]}}','active')" value="active">active</option>
                    <option onclick="changeStatus('{{row[0]}}','inactive')" value="inactive">inactive</option>
                  </select>

                </div>
              </td>

              <td><button class="buttonTable" onclick="sendNewPassword('{{row[0]}}')">Regenerate</button></td>
              <!--<td>
                <input type="text" id="messageTo{{row[0]}}">
                <button onclick="sendMessage('{{row[0]}}')">SEND CHAT</button>
              </td>-->
              <td class="{{customer_plan}}">
                <button class="buttonTable" onclick="deleteUser('{{row[0]}}')">Delete user</button>
              </td>
            </tr>

            {% endfor %}
          </table>

      </div>

      <script>
      document.getElementById("tHead0").click();
      document.getElementById("tHead0").click();

        function sortTable(n) {
          var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
          table = document.querySelector(".sortable");
          switching = true;
          //Set the sorting direction to ascending:
          let tHead=document.getElementById("tHead"+n).innerHTML
          if (tHead[tHead.length - 1]==="▲"){
            let newTitle=document.getElementById("tHead"+n).innerHTML.slice(0, -1)+"▼"
            console.log(newTitle)
            document.getElementById("tHead"+n).innerHTML=newTitle
          }
          else if (tHead[tHead.length - 1]==="▼"){
            console.log(document.getElementById("tHead"+n).innerHTML.slice(0, -1)+"▲")
            document.getElementById("tHead"+n).innerHTML=document.getElementById("tHead"+n).innerHTML.slice(0, -1)+"▲"
          }
          else{
            document.getElementById("tHead"+n).innerHTML=document.getElementById("tHead"+n).innerHTML+" ▲"

          }
          dir = "asc";
          while (switching) {
            switching = false;
            rows = table.rows;
            for (i = 1; i < rows.length - 1; i++) {
              shouldSwitch = false;
              x = rows[i].getElementsByTagName("td")[n];
              y = rows[i + 1].getElementsByTagName("td")[n];
              if (dir == "asc") {
                if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                  shouldSwitch = true;
                  break;
                }
              } else if (dir == "desc") {
                if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                  shouldSwitch = true;
                  break;
                }
              }
            }
            if (shouldSwitch) {
              rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
              switching = true;
              switchcount++;
            } else {
              if (switchcount == 0 && dir == "asc") {
                dir = "desc";
                switching = true;
              }
            }
          }
        }
        function addUser() {
          fetch('/add_user', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              firstName: document.getElementById("firstName").value,
              lastName: document.getElementById("lastName").value,
              email: document.getElementById("emailAdd").value
            })
          })
            .then(response => { console.log(response.status); window.location.reload() })
            .catch(error => console.error('Error:', error));
        }
        function sendMessage(email) {
          fetch('/send_message', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              email: email,
              message: document.getElementById("messageTo" + email).value
            })
          })
            .then(response => { console.log(response.status); vNotify.info({ text: 'Message sent by chat.', title: 'Info', sticky: true }); })
            .catch(error => console.error('Error:', error));
        }
        function logout() {
          fetch('/logout', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
          })
            .then(response => { console.log(response.status); window.location.replace("/") })
            .catch(error => console.error('Error:', error));
        }
        function deleteUser(email) {
          console.log(email)
          fetch('/delete_user', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email: email })

          })
            .then(response => { console.log(response.status); window.location.reload() })
            .catch(error => console.error('Error:', error));
        }
        function sendNewPassword(email) {
          fetch('/update_password_user', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              email: email

            })
          })
            .then(response => { console.log(response.status); vNotify.info({ text: 'A new password has been sent to ' + email, title: 'Info', sticky: true }); })
            .catch(error => console.error('Error:', error));
        }
        function alertUsers() {
          fetch('/alert_new_config', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({})

          })
            .then(response => { console.log(response.status); vNotify.info({ text: 'Users have been alerted about the new configuration update.', title: 'Info', sticky: true }); })
            .catch(error => console.error('Error:', error));
        }
        function sendInfo() {
          fetch('/alert_users', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ "message": document.getElementById("message").value })

          })
            .then(response => { console.log(response.status); vNotify.info({ text: 'Info has been sent trough chat to users.', title: 'Info', sticky: true }); })
            .catch(error => console.error('Error:', error));
        }
        function changeStatus(email, newStatus) {
          fetch('/change_status', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ "email": email, "newStatus": newStatus })

          })
            .then(response => { console.log(response.status); vNotify.info({ text: 'Status of ' + email + ' has been updated to ' + newStatus, title: 'Info', sticky: true }); })
            .catch(error => console.error('Error:', error));
        }
        {% for row in rows %}

        document.getElementById("newStatus{{row[0]}}").value = "{{row[3]}}"

        {% endfor %}

      </script>
    </div>


    <div class="bg-white-color ">
      <footer class="footer-02" id="footer">
        <div class="footer-02__wrapper">
          <div class="footer-02__text content_box">
            <p id="line1Footer">Version {{version}} &copy;2023&nbsp;Altme All rights reserved, <a
                href="https://altme.io/cgu/" target="_blank">CGU</a>, <a href="https://altme.io/privacy/"
                target="_blank">Privacy</a></p>
            <p id="line2Footer" hidden><strong>Built with TzKT API, Spruce Didkit 0.4.0</strong>&nbsp;</p>
          </div>
          <div class="social-buttons  ">
            <div class="social-buttons__item"><a class="social-buttons__link social-buttons__link--twitter"
                href="https://twitter.com/Altme_io" target="_blank"><img loading="lazy" class="social-buttons__icon"
                  alt="twitter icon"
                  src="https://dvzvtsvyecfyp.cloudfront.net/static/img/icons/social/black/twitter.svg" /></a></div>
            <div class="social-buttons__item"><a class="social-buttons__link social-buttons__link--linkedin"
                href="https://www.linkedin.com/company/altme-web3/" target="_blank"><img loading="lazy"
                  class="social-buttons__icon" alt="linkedin icon"
                  src="https://dvzvtsvyecfyp.cloudfront.net/static/img/icons/social/black/linkedin.svg" /></a></div>
          </div>
        </div>
      </footer>
    </div>
    <script>
      document.getElementById('buttonMenu').addEventListener('click', () => {
        if (document.getElementById('imageButtonMenu').getAttribute("class") === "imgButtonMenuInactive") {
          document.getElementById('menuDiv').setAttribute("class", "flex");
          document.body.style.overflow = 'hidden';
          document.getElementById('imageButtonMenu').setAttribute("class", "imgButtonMenuActive");
          document.getElementById('imageButtonMenu').setAttribute("src", "/static/img/crossMenu.png")
        }
        else if (document.getElementById('imageButtonMenu').getAttribute("class") === "imgButtonMenuActive") {
          document.getElementById('menuDiv').setAttribute("class", "");
          document.body.style.overflow = '';
          document.getElementById('imageButtonMenu').setAttribute("class", "imgButtonMenuInactive");
          document.getElementById('imageButtonMenu').setAttribute("src", "/static/img/div.png")
        }
      })


      if ("{{ customer_plan }}" === "free") {
        elements = document.getElementsByClassName("inputDashboardfree")
        for (var i = 0; i < elements.length; i++) {
          elements[i].setAttribute("disabled", true)
        }
        document.getElementById("buttonAddUserfree").setAttribute("disabled", true)
      }
    </script>
  </body>

  </html>