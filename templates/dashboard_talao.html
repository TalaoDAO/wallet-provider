<!DOCTYPE html>
<html>

<head>
    <title>Dashboard</title>
    <link rel="stylesheet" type="text/css" href="/static/dashboard.css">

</head>

<body>
    <p id="dashboardTitle">Dashboard admin Talao</p>
    <button id="logout" onclick="logout()">Logout</button>
    <div>
        <input type="text" id="newOrganisation" placeholder="Name of the organisation">
        <input type="text" id="emailAdmin" placeholder="Email of the admin">
        <input type="text" id="firstNameAdmin" placeholder="First name of the admin">
        <input type="text" id="lastNameAdmin" placeholder="Last name of the admin">
        <input type="text" id="companyName" placeholder="Company name">
        <input type="text" id="companyWebsite" placeholder="Company website">
        <button onclick="addOrganisation()">Add organisation</button>
    </div>
    <button onclick="displayJson1()">Show organisations</button>
    <button onclick="displayJson2()">Show admins</button>
    <div id="table-container"></div>
    <script>
        var json1 = [
            {% for row in organisations %}
        { "{{row[0]}}": { "config" : "{{row[1]}}", "configured": "{{row[2]}}" } },
        {% endfor %}
]
        var json2 = [
            {% for row in admins %}
        { "{{row[0]}}": { "organisation" : "{{row[1]}}", "password": "{{row[2]}}" } },
        {% endfor %}
]
        function logout() {
            fetch('/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
                .then(response => { console.log(response.status); window.location.replace("/") })
                .catch(error => console.error('Error:', error));
        }
        function addOrganisation() {
            fetch('/add_organisation', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    organisation: document.getElementById("newOrganisation").value,
                    emailAdmin: document.getElementById("emailAdmin").value,
                    firstNameAdmin: document.getElementById("firstNameAdmin").value,
                    lastNameAdmin: document.getElementById("lastNameAdmin").value,
                    companyName: document.getElementById("companyName").value,
                    companyWebsite: document.getElementById("companyWebsite").value,
                })
            })
                .then(response => console.log(response.status))
                .catch(error => console.error('Error:', error));
        }
        function displayJson1() {
            displayTableOrganisations(json1);
        }

        function displayJson2() {
            displayTableAdmins(json2);
        }

        function displayTableOrganisations(json) {
            var table = "<table border='1'>";
            for (let i = 0; i < json.length; i++) {
                table += "<tr><td>" + Object.keys(json[i])[0] + "</td><td>" + json[i][Object.keys(json[i])[0]]["configured"] + "</td></tr>";
            }
            table += "</table>";
            document.getElementById("table-container").innerHTML = table;
        }
        function displayTableAdmins(json) {
            var table = "<table border='1'>";
            for (let i = 0; i < json.length; i++) {
                table += "<tr><td>" + Object.keys(json[i])[0] + "</td><td>" + json[i][Object.keys(json[i])[0]]["organisation"] + "</td></tr>";
            }
            table += "</table>";
            document.getElementById("table-container").innerHTML = table;
        }
    </script>
</body>

</html>