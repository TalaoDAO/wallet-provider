<!DOCTYPE html>
<html>

<head>
  <title>Login</title>
</head>

<body>
  <p>Enter your password for {{email}}</p>
  <input type="password" placeholder="Your password" id="password">
  <button id="loginButton" onclick="login()">Go</button>
  <button onclick="logout()">Change email</button>

  <script>

    function login() {
      data = { password: document.getElementById("password").value };
      fetch("{{server}}/login_password", {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      }).then(response => {
        if (response.status != 200) {
          console.log("Invalid password or email")
        }
        response.json().then((data) => {
          if (data.organisation === "Talao") {
            window.location.replace("/dashboard_talao")
          }
          else if (data.configured === 1) {
            window.location.replace("/dashboard")
          }
          else {
            window.location.replace("/setup")
          }
        })
      })
    }
    function logout() {
      fetch('/logout', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
      })
        .then(response => { console.log(response.status); window.location.replace("/") })
        .catch(error => console.error('Error:', error));
    }
  </script>
</body>

</html>